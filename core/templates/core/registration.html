<!DOCTYPE html>
<html>
<head>
    <title>Flight-Flow | Register</title>
    {% load static %}
    <link href="https://fonts.googleapis.com/css?family=Poppins:400,500,600,700&display=swap" rel="stylesheet">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background: url("{% static 'core/img/pier-sea-beautiful-sunset-zanzibar-east-africa.jpg' %}") no-repeat center center fixed;
            background-size: cover;
            color: #1A1A1A;
            min-height: 100vh;
        }
        .navbar {
            background: rgba(255,255,255,0.85);
            box-shadow: 0 2px 8px rgba(2,138,158,0.08);
            padding: 0.5em 2em;
        }
        .navbar .logo img {
            max-height: 60px;
            width: auto;
            display: block;
        }
        .register-container {
            max-width: 500px;
            margin: 60px auto;
            background: rgba(255,255,255,0.92);
            border-radius: 16px;
            box-shadow: 0 4px 16px rgba(2,138,158,0.07);
            padding: 32px 32px;
            position: relative;
            z-index: 2;
        }
        h1, h2 {
            color: #028A9E;
            font-size: 2em;
            margin-bottom: 24px;
            text-align: center;
        }
        label {
            font-weight: 500;
        }
        .form-control, .btn {
            border-radius: 8px;
        }
        .btn-primary {
            background: #028A9E;
            border: none;
        }
        .btn-primary:hover {
            background: #F7C948;
            color: #028A9E;
        }
        .login-link {
            display: block;
            text-align: center;
            margin-top: 18px;
        }
        .step {
            display: none;
        }
        .step.active {
            display: block;
        }
        /* --- Mobile Friendly Styles --- */
        @media (max-width: 700px) {
            .register-container {
                max-width: 98vw;
                margin: 16px auto;
                padding: 12px 6px;
            }
            h1, h2 {
                font-size: 1.3em;
                margin-bottom: 16px;
            }
            .form-control {
                font-size: 1em;
                padding: 8px 10px;
            }
            .btn, .btn-primary {
                font-size: 1em;
                padding: 10px 0;
            }
            .mb-3.d-flex.gap-2 {
                gap: 4px !important;
            }
            .code-input {
                width: 32px !important;
                font-size: 1.2em !important;
            }
        }
    </style>
</head>
<body>
    <nav class="navbar">
        <span class="logo">
            <img src="{% static 'core/img/WhatsApp_Image_2025-06-19_at_11.15.24_815a1b9d-removebg-preview.png' %}" alt="Flight-Flow Logo">
        </span>
    </nav>
    <div class="register-container">
        <form id="multiStepForm" method="post">
            {% csrf_token %}
            <input type="hidden" id="stepInput" name="step" value="1">
            <!-- Step 1: Name -->
            <div class="step active" id="step1">
                <h1>Create Account</h1>
                <div class="mb-3">
                    <label for="first_name" class="form-label">First Name</label>
                    <input type="text" class="form-control" id="first_name" name="first_name" required>
                </div>
                <div class="mb-3">
                    <label for="last_name" class="form-label">Last Name</label>
                    <input type="text" class="form-control" id="last_name" name="last_name" required>
                </div>
                <button type="button" class="btn btn-primary w-100" onclick="nextStep(2)">Next</button>
            </div>
            <!-- Step 2: Personal Info -->
            <div class="step" id="step2">
                <h2>Hello, <span id="greetName"></span>!</h2>
                <p class="mb-3">Tell us more about yourself.</p>
                <div class="mb-3">
                    <label for="country" class="form-label">Country of Residence</label>
                    <select class="form-control" id="country" name="country" required>
                        <option value="">Select Country</option>
                        <option value="Nigeria">Nigeria</option>
                        <option value="Kenya">Kenya</option>
                        <option value="Tanzania">Tanzania</option>
                        <option value="South Africa">South Africa</option>
                        <option value="Ghana">Ghana</option>
                        <option value="United States">United States</option>
                        <option value="United Kingdom">United Kingdom</option>
                        <!-- Add more countries as needed -->
                    </select>
                </div>
                <div class="mb-3">
                    <label for="dob" class="form-label">Date of Birth</label>
                    <input type="date" class="form-control" id="dob" name="dob" required>
                </div>
                <div class="mb-3">
                    <label for="title" class="form-label">Preferred Title</label>
                    <select class="form-control" id="title" name="title" required>
                        <option value="">Select Title</option>
                        <option value="Mr">Mr</option>
                        <option value="Miss">Miss</option>
                        <option value="Mrs">Mrs</option>
                        <option value="I'd rather not say">I'd rather not say</option>
                    </select>
                </div>
                <button type="button" class="btn btn-primary w-100" onclick="nextStep(3)">Continue</button>
            </div>
            <!-- Step 3: Email -->
            <div class="step" id="step3">
                <h2>Email Address</h2>
                <div class="mb-3">
                    <label for="email" class="form-label">Email</label>
                    <input type="email" class="form-control" id="email" name="email" required>
                </div>
                <button type="button" class="btn btn-primary w-100" onclick="nextStep(4)">Next</button>
            </div>
            <!-- Step 4: Email Verification -->
            <div class="step" id="step4">
                <h2>Verify Your Email</h2>
                <p>We've sent a 6-digit code to <span id="verifyEmail"></span>. Enter it below:</p>
                <div class="mb-3 d-flex justify-content-center gap-2">
                    {% for i in "123456" %}
                    <input type="text" class="form-control code-input" maxlength="1" pattern="[0-9]*" inputmode="numeric"
                           style="width:40px; text-align:center; font-size:1.5em;" id="code{{ forloop.counter }}" name="code{{ forloop.counter }}" required>
                    {% endfor %}
                </div>
                <div class="text-center mb-3">
                    <a href="#" id="resendCodeLink" style="font-size:0.95em; color:#028A9E; text-decoration:underline;">
                        Didn't receive code? Click to resend
                    </a>
                </div>
                <button type="button" class="btn btn-primary w-100" onclick="nextStep(5)">Next</button>
            </div>
            <!-- Step 5: Password -->
            <div class="step" id="step5">
                <h2>Create Password</h2>
                <div class="mb-3">
                    <label for="password1" class="form-label">Password</label>
                    <input type="password" class="form-control" id="password1" name="password1" required>
                </div>
                <div class="mb-3">
                    <label for="password2" class="form-label">Confirm Password</label>
                    <input type="password" class="form-control" id="password2" name="password2" required>
                </div>
                <button type="submit" class="btn btn-primary w-100">Create Account</button>
            </div>
        </form>
        <a href="{% url 'login' %}" class="login-link">Already have an account? Login</a>
    </div>
    <script>
        function nextStep(step) {
            document.getElementById('stepInput').value = step;
            // Hide all steps
            document.querySelectorAll('.step').forEach(function(s) {
                s.classList.remove('active');
            });
            // Show the requested step
            document.getElementById('step' + step).classList.add('active');
            // Personalize greeting
            if (step === 2) {
                document.getElementById('greetName').textContent =
                    document.getElementById('first_name').value + ' ' + document.getElementById('last_name').value;
            }
            // Show email in verification step
            if (step === 4) {
                document.getElementById('verifyEmail').textContent =
                    document.getElementById('email').value;
                // TODO: Trigger backend to send verification code to email
            }
        }

        document.querySelectorAll('.code-input').forEach((input, idx, arr) => {
            input.addEventListener('input', function() {
                if (this.value.length === 1 && idx < arr.length - 1) {
                    arr[idx + 1].focus();
                }
            });
            input.addEventListener('keydown', function(e) {
                if (e.key === 'Backspace' && !this.value && idx > 0) {
                    arr[idx - 1].focus();
                }
            });
        });

        document.getElementById('resendCodeLink').addEventListener('click', function(e) {
            e.preventDefault();
            fetch("{% url 'resend_code' %}", {
                method: "POST",
                headers: {
                    "X-CSRFToken": document.querySelector('[name=csrfmiddlewaretoken]').value,
                    "Content-Type": "application/x-www-form-urlencoded"
                },
                body: "email=" + encodeURIComponent(document.getElementById('email').value)
            })
            .then(response => response.json())
            .then(data => {
                alert(data.message);
            });
        });
    </script>
</body>
</html>